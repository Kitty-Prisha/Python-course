(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{393:function(e,t,r){(function(e){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var a=e[n];"."===a?e.splice(n,1):".."===a?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var t="",a=!1,o=arguments.length-1;o>=-1&&!a;o--){var i=o>=0?arguments[o]:e.cwd();if("string"!==typeof i)throw new TypeError("Arguments to path.resolve must be strings");i&&(t=i+"/"+t,a="/"===i.charAt(0))}return(a?"/":"")+(t=r(n(t.split("/"),(function(e){return!!e})),!a).join("/"))||"."},t.normalize=function(e){var o=t.isAbsolute(e),i="/"===a(e,-1);return(e=r(n(e.split("/"),(function(e){return!!e})),!o).join("/"))||o||(e="."),e&&i&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var a=n(e.split("/")),o=n(r.split("/")),i=Math.min(a.length,o.length),s=i,u=0;u<i;u++)if(a[u]!==o[u]){s=u;break}var c=[];for(u=s;u<a.length;u++)c.push("..");return(c=c.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!a){n=o;break}}else a=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!==typeof e&&(e+="");var t,r=0,n=-1,a=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!a){r=t+1;break}}else-1===n&&(a=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,r=0,n=-1,a=!0,o=0,i=e.length-1;i>=0;--i){var s=e.charCodeAt(i);if(47!==s)-1===n&&(a=!1,n=i+1),46===s?-1===t?t=i:1!==o&&(o=1):-1!==t&&(o=-1);else if(!a){r=i+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)};var a="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}}).call(this,r(127))},409:function(e,t){},452:function(e,t,r){"use strict";(function(e,n,a){var o=function(){var t="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return t=t||e,function(e){var o,i,s="undefined"!==typeof(e=e||{})?e:{};s.ready=new Promise((function(e,t){o=e,i=t}));var u,c={};for(u in s)s.hasOwnProperty(u)&&(c[u]=s[u]);var f=[],l="./this.program",d=function(e,t){throw t},m=!1,p=!1,g=!1,h=!1;m="object"===typeof window,p="function"===typeof importScripts,g="object"===typeof n&&"object"===typeof n.versions&&"string"===typeof n.versions.node,h=!m&&!g&&!p;var v,b,E,y,_,A="";function T(e){return s.locateFile?s.locateFile(e,A):A+e}g?(A=p?r(393).dirname(A)+"/":a+"/",v=function(e,t){return y||(y=r(409)),_||(_=r(393)),e=_.normalize(e),y.readFileSync(e,t?null:"utf8")},E=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),U(t.buffer),t},n.argv.length>1&&(l=n.argv[1].replace(/\\/g,"/")),f=n.argv.slice(2),n.on("uncaughtException",(function(e){if(!(e instanceof je))throw e})),n.on("unhandledRejection",ae),d=function(e){n.exit(e)},s.inspect=function(){return"[Emscripten Module object]"}):h?("undefined"!=typeof read&&(v=function(e){return read(e)}),E=function(e){var t;return"function"===typeof readbuffer?new Uint8Array(readbuffer(e)):(U("object"===typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?f=scriptArgs:"undefined"!=typeof arguments&&(f=arguments),"function"===typeof quit&&(d=function(e){quit(e)}),"undefined"!==typeof print&&("undefined"===typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!==typeof printErr?printErr:print)):(m||p)&&(p?A=self.location.href:"undefined"!==typeof document&&document.currentScript&&(A=document.currentScript.src),t&&(A=t),A=0!==A.indexOf("blob:")?A.substr(0,A.lastIndexOf("/")+1):"",v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},p&&(E=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),b=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var w,R=s.print||console.log.bind(console),x=s.printErr||console.warn.bind(console);for(u in c)c.hasOwnProperty(u)&&(s[u]=c[u]);c=null,s.arguments&&(f=s.arguments),s.thisProgram&&(l=s.thisProgram),s.quit&&(d=s.quit),s.wasmBinary&&(w=s.wasmBinary);var C,F=s.noExitRuntime||!0;"object"!==typeof WebAssembly&&ae("no native wasm support detected");var k=!1;function U(e,t){e||ae("Assertion failed: "+t)}var S,M,I,D,P="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function B(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&P)return P.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function O(e,t){return e?B(I,e,t):""}function L(e,t,r){for(var n=0;n<e.length;++n)M[t++>>0]=e.charCodeAt(n);r||(M[t>>0]=0)}function W(e,t){return e%t>0&&(e+=t-e%t),e}function H(e){S=e,s.HEAP8=M=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=D=new Int32Array(e),s.HEAPU8=I=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}s.INITIAL_MEMORY;var X,N=[],G=[],j=[],z=[];function V(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)Q(s.preRun.shift());ge(N)}function Y(){!0,ge(G)}function q(){ge(j)}function J(){!0}function Z(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)$(s.postRun.shift());ge(z)}function Q(e){N.unshift(e)}function $(e){z.unshift(e)}G.push({func:function(){Ne()}});var K=0,ee=null,te=null;function re(e){K++,s.monitorRunDependencies&&s.monitorRunDependencies(K)}function ne(e){if(K--,s.monitorRunDependencies&&s.monitorRunDependencies(K),0==K&&(null!==ee&&(clearInterval(ee),ee=null),te)){var t=te;te=null,t()}}function ae(e){s.onAbort&&s.onAbort(e),x(e+=""),k=!0,1,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function oe(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}s.preloadedImages={},s.preloadedAudios={};var ie="data:application/octet-stream;base64,";function se(e){return oe(e,ie)}var ue="file://";function ce(e){return oe(e,ue)}var fe,le="tflite.wasm";function de(e){try{if(e==le&&w)return new Uint8Array(w);if(E)return E(e);throw"both async and sync fetching of the wasm failed"}catch(x){ae(x)}}function me(){if(!w&&(m||p)){if("function"===typeof fetch&&!ce(le))return fetch(le,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+le+"'";return e.arrayBuffer()})).catch((function(){return de(le)}));if(b)return new Promise((function(e,t){b(le,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return de(le)}))}function pe(){var e={a:Xe};function t(e,t){var r=e.exports;s.asm=r,H((C=s.asm.q).buffer),X=s.asm.D,ne()}function r(e){t(e.instance)}function n(t){return me().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),ae(e)}))}if(re(),s.instantiateWasm)try{return s.instantiateWasm(e,t)}catch(a){return x("Module.instantiateWasm callback failed with error: "+a),!1}return(w||"function"!==typeof WebAssembly.instantiateStreaming||se(le)||ce(le)||"function"!==typeof fetch?n(r):fetch(le,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),n(r)}))}))).catch(i),{}}function ge(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"===typeof r?void 0===t.arg?X.get(r)():X.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(s)}}function he(){ae()}se(le)||(le=T(le)),fe=g?function(){var e=n.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof dateNow?dateNow:function(){return performance.now()};var ve=!0;function be(e){return D[Ge()>>2]=e,e}function Ee(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e||!ve)return be(28),-1;r=fe()}return D[t>>2]=r/1e3|0,D[t+4>>2]=r%1e3*1e3*1e3|0,0}function ye(e,t){ae("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")}function _e(e,t){ae("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")}function Ae(e,t,r){I.copyWithin(e,t,t+r)}function Te(){return I.length}function we(e){try{return C.grow(e-S.byteLength+65535>>>16),H(C.buffer),1}catch(t){}}function Re(e){var t=Te();if(e>2147483648)return!1;for(var r=1;r<=4;r*=2){var n=t*(1+.2/r);if(n=Math.min(n,e+100663296),we(Math.min(2147483648,W(Math.max(e,n),65536))))return!0}return!1}function xe(e){for(var t=fe();fe()-t<e;);}var Ce={};function Fe(){return l||"./this.program"}function ke(){if(!ke.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Fe()};for(var t in Ce)e[t]=Ce[t];var r=[];for(var t in e)r.push(t+"="+e[t]);ke.strings=r}return ke.strings}var Ue={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=Ue.buffers[e];0===t||10===t?((1===e?R:x)(B(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return Ue.varargs+=4,D[Ue.varargs-4>>2]},getStr:function(e){return O(e)},get64:function(e,t){return e}};function Se(e,t){var r=0;return ke().forEach((function(n,a){var o=t+r;D[e+4*a>>2]=o,L(n,o),r+=n.length+1})),0}function Me(e,t){var r=ke();D[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),D[t>>2]=n,0}function Ie(e){Ve(e)}function De(e){return 0}function Pe(e,t,r,n,a){}function Be(e,t,r,n){for(var a=0,o=0;o<r;o++){for(var i=D[t+8*o>>2],s=D[t+(8*o+4)>>2],u=0;u<s;u++)Ue.printChar(e,I[i+u]);a+=s}return D[n>>2]=a,0}function Oe(){return 6}function Le(){return 28}function We(e){switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===typeof navigator&&navigator.hardwareConcurrency||1}return be(28),-1}var He,Xe={a:he,n:Ee,i:ye,e:_e,l:Ae,m:Re,o:xe,p:Se,g:Me,j:Ie,h:De,k:Pe,c:Be,d:Oe,f:Le,b:We},Ne=(pe(),s.___wasm_call_ctors=function(){return(Ne=s.___wasm_call_ctors=s.asm.r).apply(null,arguments)}),Ge=(s._getModelBufferMemoryOffset=function(){return(s._getModelBufferMemoryOffset=s.asm.s).apply(null,arguments)},s._getInputMemoryOffset=function(){return(s._getInputMemoryOffset=s.asm.t).apply(null,arguments)},s._getInputHeight=function(){return(s._getInputHeight=s.asm.u).apply(null,arguments)},s._getInputWidth=function(){return(s._getInputWidth=s.asm.v).apply(null,arguments)},s._getInputChannelCount=function(){return(s._getInputChannelCount=s.asm.w).apply(null,arguments)},s._getOutputMemoryOffset=function(){return(s._getOutputMemoryOffset=s.asm.x).apply(null,arguments)},s._getOutputHeight=function(){return(s._getOutputHeight=s.asm.y).apply(null,arguments)},s._getOutputWidth=function(){return(s._getOutputWidth=s.asm.z).apply(null,arguments)},s._getOutputChannelCount=function(){return(s._getOutputChannelCount=s.asm.A).apply(null,arguments)},s._loadModel=function(){return(s._loadModel=s.asm.B).apply(null,arguments)},s._runInference=function(){return(s._runInference=s.asm.C).apply(null,arguments)},s.___errno_location=function(){return(Ge=s.___errno_location=s.asm.E).apply(null,arguments)});function je(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ze(e){function t(){He||(He=!0,s.calledRun=!0,k||(Y(),q(),o(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),Z()))}e=e||f,K>0||(V(),K>0||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t()))}function Ve(e,t){t&&F&&0===e||(F||(e,J(),s.onExit&&s.onExit(e),k=!0),d(e,new je(e)))}if(te=function e(){He||ze(),He||(te=e)},s.run=ze,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();return ze(),e.ready}}();t.a=o}).call(this,"/index.js",r(127),"/")},453:function(e,t,r){"use strict";(function(e,n,a){var o=function(){var t="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return t=t||e,function(e){var o,i,s="undefined"!==typeof(e=e||{})?e:{};s.ready=new Promise((function(e,t){o=e,i=t}));var u,c={};for(u in s)s.hasOwnProperty(u)&&(c[u]=s[u]);var f=[],l="./this.program",d=function(e,t){throw t},m=!1,p=!1,g=!1,h=!1;m="object"===typeof window,p="function"===typeof importScripts,g="object"===typeof n&&"object"===typeof n.versions&&"string"===typeof n.versions.node,h=!m&&!g&&!p;var v,b,E,y,_,A="";function T(e){return s.locateFile?s.locateFile(e,A):A+e}g?(A=p?r(393).dirname(A)+"/":a+"/",v=function(e,t){return y||(y=r(409)),_||(_=r(393)),e=_.normalize(e),y.readFileSync(e,t?null:"utf8")},E=function(e){var t=v(e,!0);return t.buffer||(t=new Uint8Array(t)),U(t.buffer),t},n.argv.length>1&&(l=n.argv[1].replace(/\\/g,"/")),f=n.argv.slice(2),n.on("uncaughtException",(function(e){if(!(e instanceof je))throw e})),n.on("unhandledRejection",ae),d=function(e){n.exit(e)},s.inspect=function(){return"[Emscripten Module object]"}):h?("undefined"!=typeof read&&(v=function(e){return read(e)}),E=function(e){var t;return"function"===typeof readbuffer?new Uint8Array(readbuffer(e)):(U("object"===typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?f=scriptArgs:"undefined"!=typeof arguments&&(f=arguments),"function"===typeof quit&&(d=function(e){quit(e)}),"undefined"!==typeof print&&("undefined"===typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!==typeof printErr?printErr:print)):(m||p)&&(p?A=self.location.href:"undefined"!==typeof document&&document.currentScript&&(A=document.currentScript.src),t&&(A=t),A=0!==A.indexOf("blob:")?A.substr(0,A.lastIndexOf("/")+1):"",v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},p&&(E=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),b=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var w,R=s.print||console.log.bind(console),x=s.printErr||console.warn.bind(console);for(u in c)c.hasOwnProperty(u)&&(s[u]=c[u]);c=null,s.arguments&&(f=s.arguments),s.thisProgram&&(l=s.thisProgram),s.quit&&(d=s.quit),s.wasmBinary&&(w=s.wasmBinary);var C,F=s.noExitRuntime||!0;"object"!==typeof WebAssembly&&ae("no native wasm support detected");var k=!1;function U(e,t){e||ae("Assertion failed: "+t)}var S,M,I,D,P="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function B(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&P)return P.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function O(e,t){return e?B(I,e,t):""}function L(e,t,r){for(var n=0;n<e.length;++n)M[t++>>0]=e.charCodeAt(n);r||(M[t>>0]=0)}function W(e,t){return e%t>0&&(e+=t-e%t),e}function H(e){S=e,s.HEAP8=M=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=D=new Int32Array(e),s.HEAPU8=I=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}s.INITIAL_MEMORY;var X,N=[],G=[],j=[],z=[];function V(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)Q(s.preRun.shift());ge(N)}function Y(){!0,ge(G)}function q(){ge(j)}function J(){!0}function Z(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)$(s.postRun.shift());ge(z)}function Q(e){N.unshift(e)}function $(e){z.unshift(e)}G.push({func:function(){Ne()}});var K=0,ee=null,te=null;function re(e){K++,s.monitorRunDependencies&&s.monitorRunDependencies(K)}function ne(e){if(K--,s.monitorRunDependencies&&s.monitorRunDependencies(K),0==K&&(null!==ee&&(clearInterval(ee),ee=null),te)){var t=te;te=null,t()}}function ae(e){s.onAbort&&s.onAbort(e),x(e+=""),k=!0,1,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function oe(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}s.preloadedImages={},s.preloadedAudios={};var ie="data:application/octet-stream;base64,";function se(e){return oe(e,ie)}var ue="file://";function ce(e){return oe(e,ue)}var fe,le="tflite-simd.wasm";function de(e){try{if(e==le&&w)return new Uint8Array(w);if(E)return E(e);throw"both async and sync fetching of the wasm failed"}catch(x){ae(x)}}function me(){if(!w&&(m||p)){if("function"===typeof fetch&&!ce(le))return fetch(le,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+le+"'";return e.arrayBuffer()})).catch((function(){return de(le)}));if(b)return new Promise((function(e,t){b(le,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return de(le)}))}function pe(){var e={a:Xe};function t(e,t){var r=e.exports;s.asm=r,H((C=s.asm.q).buffer),X=s.asm.D,ne()}function r(e){t(e.instance)}function n(t){return me().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),ae(e)}))}if(re(),s.instantiateWasm)try{return s.instantiateWasm(e,t)}catch(a){return x("Module.instantiateWasm callback failed with error: "+a),!1}return(w||"function"!==typeof WebAssembly.instantiateStreaming||se(le)||ce(le)||"function"!==typeof fetch?n(r):fetch(le,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),n(r)}))}))).catch(i),{}}function ge(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"===typeof r?void 0===t.arg?X.get(r)():X.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(s)}}function he(){ae()}se(le)||(le=T(le)),fe=g?function(){var e=n.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!==typeof dateNow?dateNow:function(){return performance.now()};var ve=!0;function be(e){return D[Ge()>>2]=e,e}function Ee(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e||!ve)return be(28),-1;r=fe()}return D[t>>2]=r/1e3|0,D[t+4>>2]=r%1e3*1e3*1e3|0,0}function ye(e,t){ae("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")}function _e(e,t){ae("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")}function Ae(e,t,r){I.copyWithin(e,t,t+r)}function Te(){return I.length}function we(e){try{return C.grow(e-S.byteLength+65535>>>16),H(C.buffer),1}catch(t){}}function Re(e){var t=Te();if(e>2147483648)return!1;for(var r=1;r<=4;r*=2){var n=t*(1+.2/r);if(n=Math.min(n,e+100663296),we(Math.min(2147483648,W(Math.max(e,n),65536))))return!0}return!1}function xe(e){for(var t=fe();fe()-t<e;);}var Ce={};function Fe(){return l||"./this.program"}function ke(){if(!ke.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Fe()};for(var t in Ce)e[t]=Ce[t];var r=[];for(var t in e)r.push(t+"="+e[t]);ke.strings=r}return ke.strings}var Ue={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=Ue.buffers[e];0===t||10===t?((1===e?R:x)(B(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return Ue.varargs+=4,D[Ue.varargs-4>>2]},getStr:function(e){return O(e)},get64:function(e,t){return e}};function Se(e,t){var r=0;return ke().forEach((function(n,a){var o=t+r;D[e+4*a>>2]=o,L(n,o),r+=n.length+1})),0}function Me(e,t){var r=ke();D[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),D[t>>2]=n,0}function Ie(e){Ve(e)}function De(e){return 0}function Pe(e,t,r,n,a){}function Be(e,t,r,n){for(var a=0,o=0;o<r;o++){for(var i=D[t+8*o>>2],s=D[t+(8*o+4)>>2],u=0;u<s;u++)Ue.printChar(e,I[i+u]);a+=s}return D[n>>2]=a,0}function Oe(){return 6}function Le(){return 28}function We(e){switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===typeof navigator&&navigator.hardwareConcurrency||1}return be(28),-1}var He,Xe={a:he,n:Ee,i:ye,e:_e,l:Ae,m:Re,o:xe,p:Se,g:Me,j:Ie,h:De,k:Pe,c:Be,d:Oe,f:Le,b:We},Ne=(pe(),s.___wasm_call_ctors=function(){return(Ne=s.___wasm_call_ctors=s.asm.r).apply(null,arguments)}),Ge=(s._getModelBufferMemoryOffset=function(){return(s._getModelBufferMemoryOffset=s.asm.s).apply(null,arguments)},s._getInputMemoryOffset=function(){return(s._getInputMemoryOffset=s.asm.t).apply(null,arguments)},s._getInputHeight=function(){return(s._getInputHeight=s.asm.u).apply(null,arguments)},s._getInputWidth=function(){return(s._getInputWidth=s.asm.v).apply(null,arguments)},s._getInputChannelCount=function(){return(s._getInputChannelCount=s.asm.w).apply(null,arguments)},s._getOutputMemoryOffset=function(){return(s._getOutputMemoryOffset=s.asm.x).apply(null,arguments)},s._getOutputHeight=function(){return(s._getOutputHeight=s.asm.y).apply(null,arguments)},s._getOutputWidth=function(){return(s._getOutputWidth=s.asm.z).apply(null,arguments)},s._getOutputChannelCount=function(){return(s._getOutputChannelCount=s.asm.A).apply(null,arguments)},s._loadModel=function(){return(s._loadModel=s.asm.B).apply(null,arguments)},s._runInference=function(){return(s._runInference=s.asm.C).apply(null,arguments)},s.___errno_location=function(){return(Ge=s.___errno_location=s.asm.E).apply(null,arguments)});function je(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ze(e){function t(){He||(He=!0,s.calledRun=!0,k||(Y(),q(),o(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),Z()))}e=e||f,K>0||(V(),K>0||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t()))}function Ve(e,t){t&&F&&0===e||(F||(e,J(),s.onExit&&s.onExit(e),k=!0),d(e,new je(e)))}if(te=function e(){He||ze(),He||(te=e)},s.run=ze,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();return ze(),e.ready}}();t.a=o}).call(this,"/index.js",r(127),"/")},454:function(e,t,r){e.exports=r.p+"assets/media/tflite.409160f6.wasm"},455:function(e,t,r){e.exports=r.p+"assets/media/tflite-simd.aaf77a1c.wasm"},456:function(e,t,r){e.exports=r.p+"assets/media/segm_lite_v681.1da806bb.tflite"},457:function(e,t,r){e.exports=r.p+"assets/media/segm_full_v679.55055f66.tflite"},458:function(e,t,r){e.exports=r.p+"assets/media/selfiesegmentation_mlkit-256x256-2021_01_19-v1215.f16.f2646b79.tflite"},489:function(e,t,r){"use strict";r.r(t),r.d(t,"createEffectStream",(function(){return K})),r.d(t,"getUsablePresets",(function(){return ee})),r.d(t,"setDefaultSetup",(function(){return te}));var n={};r.r(n),r.d(n,"createEffectStream",(function(){return q}));var a=r(27);function o(){return new Worker(r.p+"assets/js/processorproxy.d9e39da1.worker.js")}var i=r(99);function s(){return new Worker(r.p+"assets/js/timer.1b04a058.worker.js")}async function u(e){if(e.backgroundUrl&&e.backgroundUrl.then){const t=await e.backgroundUrl;e.backgroundUrl=t.default||t}}function c(e,t){if(self.document){const r=self.document.createElement("canvas");return r.width=e,r.height=t,r}if(self.OffscreenCanvas)return new OffscreenCanvas(e,t)}var f=r(452),l=r(453),d=r(454),m=r.n(d),p=r(455),g=r.n(p),h=r(456),v=r.n(h),b=r(457),E=r.n(b),y=r(458),_=r.n(y);const A=e=>new URL(e,location.href).href.replace("assets/js/assets/media","assets/media"),T={meetlite:{url:A(v.a),type:1},meetfull:{url:A(E.a),type:1},mlkit:{url:A(_.a),type:2}};let w=null;const R=async()=>{if(w)return w;const e=await(async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])))();return w=await(e?l.a:f.a)({locateFile:t=>t.endsWith(".wasm")?A(e?g.a:m.a):t}),w};let x;const C=async e=>{var t;const r=T[e],n=await R();if((null===(t=x)||void 0===t?void 0:t.url)===r.url)return x;const a=await fetch(r.url),o=await a.arrayBuffer(),i=n._getModelBufferMemoryOffset();n.HEAPU8.set(new Uint8Array(o),i),n._loadModel(o.byteLength);const s=n._getInputHeight(),u=n._getInputWidth(),c=n._getInputMemoryOffset()/4,f=n._getOutputMemoryOffset()/4,l=u*s;return n._runInference(),x={tflite:n,model:r,url:r.url,inputHeight:s,inputWidth:u,inputMemoryOffset:c,outputMemoryOffset:f,segmentationPixelCount:l},x},F={maskOperation:"copy",maskFilter:"blur(4px)",personOperation:"source-in",personFilter:"none",backgroundOperation:"destination-over",backgroundFilter:"none"};function k(e){return e.backgroundBlur?function(e){switch(e){case"slight":return{...F,backgroundFilter:"blur(4px)",crop:4};case"heavy":return{...F,maskFilter:"blur(8px)",backgroundFilter:"blur(16px)",crop:16}}return{...F,maskFilter:"blur(8px)",backgroundFilter:"blur(8px)",crop:8}}(e.backgroundBlur.amount):F}async function U(e,t,r,n,a){const{tflite:o,model:i,inputHeight:s,inputWidth:u,inputMemoryOffset:f,outputMemoryOffset:l,segmentationPixelCount:d}=await C(r.segmentationModelId);let m=k(a);const p=c(u,s),g=p.getContext("2d",{willReadFrequently:!0}),h=new ImageData(u,s);let v=null,b={x:0,y:0,width:0,height:0};const E=e/t;let y=0,_=0;const A=()=>{const e=m.crop||0;e?(y=E>1?Math.round(e*E):e,_=E<1?Math.round(e/E):e):(y=0,_=0)};A();const T=n.getContext("2d");return{effectCtx:T,updateBackgroundFrame(e,t){v=e,t&&(b=t)},updateParams(e){m=k(e),A()},processFrame(r){g.drawImage(r,0,0,e,t,0,0,u,s);const a=g.getImageData(0,0,u,s);for(let e=0;e<d;e++)o.HEAPF32[f+3*e]=a.data[4*e]/255,o.HEAPF32[f+3*e+1]=a.data[4*e+1]/255,o.HEAPF32[f+3*e+2]=a.data[4*e+2]/255;o._runInference();for(let e=0;e<d;e++)if(1===i.type){const t=o.HEAPF32[l+2*e],r=o.HEAPF32[l+2*e+1],n=Math.max(t,r),a=Math.exp(t-n),i=Math.exp(r-n);h.data[4*e+3]=255*i/(a+i)}else if(2===i.type){const t=o.HEAPF32[l+e];h.data[4*e+3]=255*t}g.putImageData(h,0,0),T.globalCompositeOperation=m.maskOperation,T.filter=m.maskFilter,T.drawImage(p,0,0,u,s,0,0,e,t),T.globalCompositeOperation=m.personOperation,T.filter=m.personFilter,T.drawImage(r,0,0),T.globalCompositeOperation=m.backgroundOperation,T.filter=m.backgroundFilter,v?T.drawImage(v,b.x,b.y,b.width,b.height,0,0,e,t,0):T.drawImage(r,0,0),(y||_)&&(T.globalCompositeOperation="source-over",T.filter="none",T.drawImage(n,y,_,e-2*y,t-2*_,0,0,e,t))},dispose(){}}}const S=String.raw;function M(e,t,r,n,a){const o=function(e,t,r){const n=e.createProgram();if(e.attachShader(n,t),e.attachShader(n,r),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error("Could not link WebGL program: "+e.getProgramInfoLog(n));return n}(e,t,r),i=e.getAttribLocation(o,"a_position");e.enableVertexAttribArray(i),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0);const s=e.getAttribLocation(o,"a_texCoord");return e.enableVertexAttribArray(s),e.bindBuffer(e.ARRAY_BUFFER,a),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),o}function I(e,t,r){const n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error("Could not compile shader: "+e.getShaderInfoLog(n));return n}function D(e,t,r,n,a=e.NEAREST,o=e.NEAREST){const i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texStorage2D(e.TEXTURE_2D,1,t,r,n),i}function P(e,t,r,n,a,o,i,s){const u=S`#version 300 es
        precision highp float;
        uniform sampler2D u_inputFrame;
        uniform sampler2D u_personMask;
        uniform float u_weight[20];
        uniform float u_offset[20];
        uniform int u_ksize;
        uniform vec2 u_texelSize;
        in vec2 v_texCoord;
        out vec4 outColor;
        void main() {
            vec4 centerColor = texture(u_inputFrame, v_texCoord);
            float personMask = texture(u_personMask, v_texCoord).a;
            vec4 frameColor = centerColor * u_weight[0] * (1.0 - personMask);
            for (int i = 1; i < u_ksize; i++) {
                vec2 offset = vec2(u_offset[i]) * u_texelSize;
                vec2 texCoord = v_texCoord + offset;
                frameColor += texture(u_inputFrame, texCoord) * u_weight[i] *
                    (1.0 - texture(u_personMask, texCoord).a);
                texCoord = v_texCoord - offset;
                frameColor += texture(u_inputFrame, texCoord) * u_weight[i] *
                    (1.0 - texture(u_personMask, texCoord).a);
            }
            outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);
        }`,c=s.backgroundResampleScale||.2,f=Math.round(o*c),l=Math.round(i*c),d=1/f,m=1/l,p=I(e,e.FRAGMENT_SHADER,u),g=M(e,t,p,r,n),h=e.getUniformLocation(g,"u_inputFrame"),v=e.getUniformLocation(g,"u_personMask"),b=e.getUniformLocation(g,"u_texelSize"),E=e.getUniformLocation(g,"u_weight"),y=e.getUniformLocation(g,"u_offset"),_=e.getUniformLocation(g,"u_ksize"),A=D(e,e.RGBA8,f,l,e.NEAREST,e.LINEAR),T=D(e,e.RGBA8,f,l,e.NEAREST,e.LINEAR),w=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,w),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,A,0);const R=e.createFramebuffer();function x(t="5x5"){if(e.useProgram(g),"9x9"===t)e.uniform1i(_,5),e.uniform1fv(E,[.227027027,.1945945946,.1216216216,.0540540541,.0162162162]),e.uniform1fv(y,[0,1,2,3,4]);else if("9x9o"===t)e.uniform1i(_,3),e.uniform1fv(E,[.2734375,.328125,.03515625]),e.uniform1fv(y,[0,1.3333333333333333,3.111111111111111]);else if("7x7"===t)e.uniform1i(_,4),e.uniform1fv(E,[.3125,.234375,.09375,.015625]),e.uniform1fv(y,[0,1,2,3]);else if("5x5"===t)e.uniform1i(_,3),e.uniform1fv(E,[.3715,.25,.0625]),e.uniform1fv(y,[0,1,2]);else if("3x3"===t)e.uniform1i(_,2),e.uniform1fv(E,[.5,.25]),e.uniform1fv(y,[0,1]);else if("101o"===t)e.uniform1i(_,6),e.uniform1fv(E,[.0824930077775077,.1570851015371093,.12909299748961606,.09061657810797075,.05427127182510044,.027687547151449544]),e.uniform1fv(y,[0,1.4851485148514851,3.4653465346534653,5.445544554455446,7.425742574257426,9.405940594059405]);else if("171o"===t)e.uniform1i(_,7),e.uniform1fv(E,[.06465218005811185,.1255973586132927,.11180602454697099,.09067345726996107,.06697712131207971,.04504642671896425,.027573521509675278]),e.uniform1fv(y,[0,1.4912280701754388,3.4795321637426904,5.4678362573099415,7.456140350877193,9.444444444444445,11.432748538011696]);else if(t.startsWith("og")){const r=parseFloat(t.substring(2)),{weights:n,positions:a}=function(e){const t=t=>Math.exp(-t*t/(2*e*e)),r=[];let n=0,a=0;for(;;){const e=t(n),o=a+(a?2*e:e);if(a&&e/o<.01&&r.length%2)break;a=o,r.push(e),n++}const o=r.map(e=>e/a),i=[o[0]],s=[0];if(o.length>=3&&o.length%2===1)for(let u=1;u<o.length;u+=2){const e=o[u],t=o[u+1],r=e+t,n=t/(e+t);i.push(r),s.push(u+n)}return{weights:i,positions:s}}(r);e.uniform1i(_,n.length),e.uniform1fv(E,n),e.uniform1fv(y,a)}}e.bindFramebuffer(e.FRAMEBUFFER,R),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,T,0),e.useProgram(g),e.uniform1i(v,1);let C=1;function F(e){x(e.kernel),C=e.numPasses||1}return F(s),{render:function(){e.viewport(0,0,f,l),e.useProgram(g),e.uniform1i(h,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a);for(let t=0;t<C;t++)e.uniform2f(b,0,m),e.bindFramebuffer(e.FRAMEBUFFER,w),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,A),e.uniform1i(h,2),e.uniform2f(b,d,0),e.bindFramebuffer(e.FRAMEBUFFER,R),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,T)},updateParams:F,cleanUp:function(){e.deleteFramebuffer(R),e.deleteFramebuffer(w),e.deleteTexture(T),e.deleteTexture(A),e.deleteProgram(g),e.deleteShader(p)}}}function B(e,t,r,n,a,o,i,s){let u=P(e,t,r,n,a,o,i,s);const c=function(e,t,r,n,a,o){const i=S`#version 300 es
        in vec2 a_position;
        in vec2 a_texCoord;
        out vec2 v_texCoord;
        void main() {
            // Flipping Y is required when rendering to canvas
            gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);
            v_texCoord = a_texCoord;
        }`,s=S`#version 300 es
        precision highp float;
        uniform sampler2D u_inputFrame;
        uniform sampler2D u_personMask;
        uniform sampler2D u_blurredInputFrame;
        uniform vec2 u_coverage;
        in vec2 v_texCoord;
        out vec4 outColor;
        void main() {
            vec3 color = texture(u_inputFrame, v_texCoord).rgb;
            vec3 blurredColor = texture(u_blurredInputFrame, v_texCoord).rgb;
            float personMask = texture(u_personMask, v_texCoord).a;
            personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);
            outColor = vec4(mix(blurredColor, color, personMask), 1.0);
        }`,u=I(e,e.VERTEX_SHADER,i),c=I(e,e.FRAGMENT_SHADER,s),f=M(e,u,c,t,r),l=e.getUniformLocation(f,"u_inputFrame"),d=e.getUniformLocation(f,"u_personMask"),m=e.getUniformLocation(f,"u_blurredInputFrame"),p=e.getUniformLocation(f,"u_coverage");function g(t){e.useProgram(f);const r=t.coverage||[0,1];e.uniform2f(p,r[0],r[1])}return e.useProgram(f),e.uniform1i(l,0),e.uniform1i(d,1),e.uniform1i(m,2),g(o),{render:function(){e.viewport(0,0,n,a),e.useProgram(f),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateParams:g,cleanUp:function(){e.deleteProgram(f),e.deleteShader(c),e.deleteShader(u)}}}(e,r,n,o,i,s);let f=s.backgroundResampleScale;return{render:function(){u.render(),c.render()},updateParams:function(s){f!==s.backgroundResampleScale&&(u.cleanUp(),u=P(e,t,r,n,a,o,i,s),f=s.backgroundResampleScale),u.updateParams(s),c.updateParams(s)},cleanUp:function(){c.cleanUp(),u.cleanUp()}}}function O(e){switch(e.amount){case"slight":return{kernel:"og5",numPasses:1,backgroundResampleScale:1,...e};case"heavy":return{kernel:"og10",numPasses:1,backgroundResampleScale:.5,...e};default:return{kernel:"og5",numPasses:1,backgroundResampleScale:.5,...e}}}function L(e){const t={coverage:e.coverage};return e.backgroundBlur?{baseEngineParams:t,...O(e.backgroundBlur)}:t}async function W(e,t,r,n,a,o){const{tflite:i,inputHeight:s,inputWidth:u,inputMemoryOffset:c,outputMemoryOffset:f,segmentationPixelCount:l}=await C(r.segmentationModelId);let d=L(a);const m=S`#version 300 es
        in vec2 a_position;
        in vec2 a_texCoord;
        out vec2 v_texCoord;
        void main() {
            gl_Position = vec4(a_position, 0.0, 1.0);
            v_texCoord = a_texCoord;
        }`,p=n.getContext("webgl2",r.webglContextSettings),g=I(p,p.VERTEX_SHADER,m),h=p.createVertexArray();p.bindVertexArray(h);const v=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,v),p.bufferData(p.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),p.STATIC_DRAW);const b=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,b),p.bufferData(p.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),p.STATIC_DRAW);const E=p.createTexture();p.bindTexture(p.TEXTURE_2D,E),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST);const y=D(p,p.RGBA8,u,s),_=u,A=s,T=D(p,p.RGBA8,_,A,p.LINEAR,p.LINEAR),w=function(e,t,r,n,a,o,i,s,u){const c=S`#version 300 es
        precision highp float;
        uniform sampler2D u_inputFrame;
        uniform sampler2D u_floatlut;
        in vec2 v_texCoord;
        uniform float u_pixelSize;
        out vec4 outColor;

        void main() {
            float x = v_texCoord.x;
            vec4 color = texture(u_inputFrame, v_texCoord);
            float r = mod(x * u_pixelSize, 3.0);
            float c = 0.0;
            if (r >= 2.0 ) c = color.b;
            else if (r >= 1.0) c = color.g;
            else c = color.r;
            outColor = texture(u_floatlut, vec2(c, 0.5));
        }`,f=I(e,e.FRAGMENT_SHADER,c),l=M(e,t,f,r,n),d=e.getUniformLocation(l,"u_inputFrame"),m=e.getUniformLocation(l,"u_pixelSize"),p=e.getUniformLocation(l,"u_floatlut"),g=D(e,e.RGBA8,3*o,i),h=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g,0);const v=new Uint8Array(a.HEAPF32.buffer,4*u,4*s*3);e.useProgram(l),e.uniform1i(d,0),e.uniform1f(m,3*o),e.uniform1i(p,3);const b=e.createTexture();e.bindTexture(e.TEXTURE_2D,b),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const E=new Float32Array(256);for(let y=0;y<256;y++)E[y]=y/256;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,256,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(E.buffer,0,1024)),{render:function(){e.viewport(0,0,3*o,i),e.useProgram(l),e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,b),e.bindFramebuffer(e.FRAMEBUFFER,h),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.readPixels(0,0,3*o,i,e.RGBA,e.UNSIGNED_BYTE,v)},cleanUp:function(){e.deleteFramebuffer(h),e.deleteTexture(g),e.deleteTexture(b),e.deleteProgram(l),e.deleteShader(f)}}}(p,g,v,b,i,u,s,l,c),R=function(e,t,r,n,a,o,i,s,u){const c=S`#version 300 es
        precision highp float;
        uniform sampler2D u_inputSegmentation;

        in vec2 v_texCoord;
        out vec4 outColor;

        float getMask(vec2 segmentation) {
            float shift = max(segmentation.r, segmentation.g);
            float backgroundExp = exp(segmentation.r - shift);
            float personExp = exp(segmentation.g - shift);
            return personExp / (backgroundExp + personExp);
        }

        void main() {
            float mask = getMask(texture(u_inputSegmentation, v_texCoord).rg);
            outColor = vec4(vec3(0.0), mask);
        }`,f=I(e,e.FRAGMENT_SHADER,c),l=M(e,t,f,r,n),d=e.getUniformLocation(l,"u_inputSegmentation"),m=D(e,e.RG32F,i,s,e.NEAREST,e.NEAREST),p=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,p),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a,0),e.useProgram(l),e.uniform1i(d,1),{render:function(){e.viewport(0,0,i,s),e.useProgram(l),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,m),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RG,e.FLOAT,o.HEAPF32,u),e.bindFramebuffer(e.FRAMEBUFFER,p),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(p),e.deleteTexture(m),e.deleteProgram(l),e.deleteShader(f)}}}(p,g,v,b,y,i,u,s,f),x=function(e,t,r,n,a,o,i,s){const u=S`#version 300 es
        precision highp float;
        uniform sampler2D u_personMask;
        uniform vec2 u_texelSize;
        in vec2 v_texCoord;
        out vec4 outColor;
        const float offset[3] = float[](0.0, 1.0, 2.0);
        const float weight[3] = float[](0.38774, 0.24477, 0.06136);
            void main() {
            float blurredAlpha = texture(u_personMask, v_texCoord).a * weight[0];
            for (int i = 1; i < 3; i++) {
                vec2 offset = vec2(offset[i]) * u_texelSize;
                vec2 texCoord = v_texCoord + offset;
                blurredAlpha += texture(u_personMask, texCoord).a * weight[i];
                texCoord = v_texCoord - offset;
                blurredAlpha += texture(u_personMask, texCoord).a * weight[i];
            }
            outColor = vec4(0,0,0,blurredAlpha);
        }`,c=1/i,f=1/s,l=I(e,e.FRAGMENT_SHADER,u),d=M(e,t,l,r,n),m=e.getUniformLocation(d,"u_personMask"),p=e.getUniformLocation(d,"u_texelSize"),g=D(e,e.RGBA8,i,s,e.NEAREST,e.NEAREST),h=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g,0);const v=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,v),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),e.useProgram(d),e.uniform1i(m,1),{render:function(){e.viewport(0,0,i,s),e.useProgram(d),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,a),e.uniform2f(p,0,f),e.bindFramebuffer(e.FRAMEBUFFER,h),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,g),e.uniform2f(p,c,0),e.bindFramebuffer(e.FRAMEBUFFER,v),e.drawArrays(e.TRIANGLE_STRIP,0,4)},cleanUp:function(){e.deleteFramebuffer(v),e.deleteFramebuffer(h),e.deleteTexture(g),e.deleteProgram(d),e.deleteShader(l)}}}(p,g,v,b,y,T,_,A),F=B(p,g,v,b,T,e,t,d),k=function(e,t,r,n,a,o,i,s){const u=S`#version 300 es
        uniform vec2 u_backgroundScale;
        uniform vec2 u_backgroundOffset;
        in vec2 a_position;
        in vec2 a_texCoord;
        out vec2 v_texCoord;
        out vec2 v_backgroundCoord;
        void main() {
            // Flipping Y for canvas
            gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);
            v_texCoord = a_texCoord;
            v_backgroundCoord = a_texCoord * u_backgroundScale + u_backgroundOffset;
        }`,c=S`#version 300 es
        precision highp float;
        uniform sampler2D u_inputFrame;
        uniform sampler2D u_personMask;
        uniform sampler2D u_background;
        uniform vec2 u_coverage;
        in vec2 v_texCoord;
        in vec2 v_backgroundCoord;
        out vec4 outColor;

        void main() {
            vec3 frameColor = texture(u_inputFrame, v_texCoord).rgb;
            vec3 backgroundColor = texture(u_background, v_backgroundCoord).rgb;
            float personMask = texture(u_personMask, v_texCoord).a;
            personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);
            outColor = vec4(frameColor * personMask + backgroundColor * (1.0 - personMask), 1.0);
        }`,f=o/i,l=I(e,e.VERTEX_SHADER,u),d=I(e,e.FRAGMENT_SHADER,c),m=M(e,l,d,t,r),p=e.getUniformLocation(m,"u_backgroundScale"),g=e.getUniformLocation(m,"u_backgroundOffset"),h=e.getUniformLocation(m,"u_inputFrame"),v=e.getUniformLocation(m,"u_personMask"),b=e.getUniformLocation(m,"u_background"),E=e.getUniformLocation(m,"u_coverage");e.useProgram(m),e.uniform2f(p,1,1),e.uniform2f(g,0,0),e.uniform1i(h,0),e.uniform1i(v,1);let y=null;function _(t){const r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;y=D(e,e.RGBA8,r,n,e.LINEAR,e.LINEAR),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGBA,e.UNSIGNED_BYTE,t);let a=0,o=0,i=r,s=n;i/s<f?(s=i/f,o=(n-s)/2):(i=s*f,a=(r-i)/2);const u=i/r,c=s/n;a/=r,o/=n,e.uniform2f(p,u,c),e.uniform2f(g,a,o)}function A(t){e.useProgram(m);const r=t.coverage||[0,1];e.uniform2f(E,r[0],r[1])}return A(s),a&&_(a),{render:function(){e.viewport(0,0,o,i),e.useProgram(m),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,n),null!==y&&(e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,y),e.uniform1i(b,2)),e.bindFramebuffer(e.FRAMEBUFFER,null),e.drawArrays(e.TRIANGLE_STRIP,0,4)},updateParams:A,cleanUp:function(){e.deleteTexture(y),e.deleteProgram(m),e.deleteShader(d),e.deleteShader(l)},updateBackgroundImage:function(t,r){r&&(y=null),t?y?(e.bindTexture(e.TEXTURE_2D,y),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.naturalWidth||t.videoWidth||t.width,t.naturalHeight||t.videoHeight||t.height,e.RGBA,e.UNSIGNED_BYTE,t)):_(t):y&&(y=null)}}}(p,v,b,T,o,e,t,d);return{effectCtx:p,updateBackgroundFrame(e,t,r){k.updateBackgroundImage(e,r)},updateParams(e){d=L(a=e),F.updateParams(d),k.updateParams(d)},processFrame(e){p.clearColor(0,0,0,0),p.clear(p.COLOR_BUFFER_BIT),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,E),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,e),p.bindVertexArray(h),w.render(),i._runInference(),R.render(),x.render(),a.backgroundUrl?k.render():F.render()},dispose(){k.cleanUp(),F.cleanUp(),x.cleanUp(),R.cleanUp(),w.cleanUp(),p.deleteTexture(T),p.deleteTexture(y),p.deleteTexture(E),p.deleteBuffer(b),p.deleteBuffer(v),p.deleteVertexArray(h),p.deleteShader(g)}}}class H extends i.EventEmitter{constructor({setup:e,params:t,videoWidth:r,videoHeight:n,emit:a}){super(),this.setup=e,this.params=t,this.videoWidth=r,this.videoHeight=n,a&&(this.emit=a)}async setupEngine(e,t,r,n){this.videoWidth=e,this.videoHeight=t,this.videoAspectRatio=this.videoWidth/this.videoHeight,this.effectCanvas=r||c(this.videoWidth,this.videoHeight);const a=this.setup.useWebGL?W:U;this.engine=await a(this.videoWidth,this.videoHeight,this.setup,this.effectCanvas,this.params,n),this.effectCtx=this.engine.effectCtx,n&&this.updateBackgroundFrame({frame:n})}async updateVideoSize({videoWidth:e,videoHeight:t}){const r=this.currentBackgroundFrame;this.currentBackgroundFrame=null;const n=this.engine;await this.setupEngine(e,t,this.effectCanvas,r),n.dispose()}async init({initialBackgroundFrame:e,useInsertableStreams:t,effectCanvas:n}){if(await this.setupEngine(this.videoWidth,this.videoHeight,n,e),t){let e=5,t=0,r=0,n=!1;this.transformer=new TransformStream({transform:async(a,o)=>{this.transformController=o;const i=a.timestamp,s=performance.now();t||(t=s,r=i/1e3);e>0||s-t<i/1e3-r+200?(this.processAndRenderFrame(a),a.close(),this.hasVideoBackground&&"canvas"!==this.setup.transferType&&this.emit("getbackgroundframe"),e>0&&(e--,t=s,r=i/1e3),o.enqueue(new VideoFrame(this.effectCanvas,{timestamp:i})),n||(n=!0,this.emit("firstframerendered"))):a.close()}})}else this.setup.useBackgroundWorker||((e=>{const t=r.p;r.p=window.location.pathname.replace(/[^\/]+\/?$/,""),e(),r.p=t})(()=>{this.timerWorker=new s}),this.timerWorker.addEventListener("message",()=>{this.emit("output",{frame:this.currentOutputFrame},[this.currentOutputFrame])}));this.emit("ready")}updateParams({params:e,initialBackgroundFrame:t}){this.params=e,this.currentBackgroundFrame=null,this.currentBackgroundFrameCtx=null,t?this.updateBackgroundFrame({frame:t,reInit:!0}):this.engine.updateBackgroundFrame(null),this.engine.updateParams(e)}updateBackgroundFrame({frame:e,reInit:t}){let r;switch(this.currentBackgroundFrame||(this.hasVideoBackground=this.params.backgroundUrl&&"video"===this.params.backgroundType,r={x:0,y:0,width:this.videoWidth,height:this.videoHeight}),this.setup.transferType){case"imagebitmap":this.currentBackgroundFrame=e;break;case"imagedata":this.currentBackgroundFrame||(this.currentBackgroundFrame=c(this.videoWidth,this.videoHeight),this.currentBackgroundFrameCtx=this.currentBackgroundFrame.getContext("2d")),e=new ImageData(new Uint8ClampedArray(e),this.videoWidth,this.videoHeight),this.currentBackgroundFrameCtx.putImageData(e,0,0);break;case"canvas":if(!this.currentBackgroundFrame){r.width=e.videoWidth||e.naturalWidth||e.width,r.height=e.videoHeight||e.naturalHeight||e.height;const t=r.width/r.height;if(t>this.videoAspectRatio){const e=r.width-r.height*this.videoAspectRatio;r.width-=e,r.x=Math.floor(e/2)}else if(t<this.videoAspectRatio){const e=r.height-r.width/this.videoAspectRatio;r.height-=e,r.y=Math.floor(e/2)}}this.currentBackgroundFrame=e}this.engine.updateBackgroundFrame(this.currentBackgroundFrame,r,t)}terminate(){this.transformController&&this.transformController.terminate(),this.timerWorker&&this.timerWorker.terminate(),this.engine&&(this.engine.dispose(),this.engine=null),this._terminated=!0,this.emit("terminated")}start({inputStream:e,outputStream:t}){e&&e.pipeThrough(this.transformer).pipeTo(t),this.frameCounter=0,this.frameCounterTime=performance.now()}async input({videoFrame:e,backgroundFrame:t,requestTime:r,lastRenderTime:n,delay:a}){if(this._terminated)return;const o=n+a-2*(Date.now()-r);let i;switch(t&&this.updateBackgroundFrame({frame:t}),this.setup.transferType){case"imagebitmap":var s;null===(s=this.prevVideoFrame)||void 0===s||s.close(),this.prevVideoFrame=e,this.processAndRenderFrame(e),i=await createImageBitmap(this.effectCanvas);break;case"imagedata":e=new ImageData(new Uint8ClampedArray(e),this.videoWidth,this.videoHeight),this.inputCanvas||(this.inputCanvas=c(this.videoWidth,this.videoHeight),this.inputCanvasCtx=this.inputCanvas.getContext("2d")),this.inputCanvasCtx.putImageData(e,0,0),this.processAndRenderFrame(this.inputCanvas),i=this.effectCtx.getImageData(0,0,this.videoWidth,this.videoHeight).data.buffer;break;case"canvas":this.processAndRenderFrame(e),i=this.effectCanvas}const u=Math.max(0,o-Date.now());this.timerWorker?(this.currentOutputFrame=i,this.timerWorker.postMessage(u)):setTimeout(()=>{this.emit("output",{frame:i},[i])},u)}processAndRenderFrame(e){if(this.engine.processFrame(e),this.setup.logToConsole){this.frameCounter++;const e=performance.now();e-this.frameCounterTime>1e3&&(console.log(`Running camera effects, ${Math.round(1e3*this.frameCounter/(e-this.frameCounterTime))} fps`),this.frameCounter=0,this.frameCounterTime=e)}}}var X=H;let N,G=0;class j extends i.EventEmitter{constructor(e,t){super();const r=G++,n=(t,n)=>{this[t]=a=>{e.postMessage({type:t,processorId:r,...a},n&&n(a).filter(e=>e))}};n("init",e=>[e.initialBackgroundFrame]),n("start",e=>[e.inputStream,e.outputStream]),n("input",e=>[e.videoFrame,e.backgroundFrame]),n("updateBackgroundFrame",e=>[e.frame]),n("updateParams",e=>[e.initialBackgroundFrame]),n("updateVideoSize"),n("terminate");const a=async t=>{if(t.data.processorId!==r)return;const{type:n,...o}=t.data;this.emit(n,o),"terminated"===n&&e.removeEventListener("message",a)};e.postMessage({type:"create",processorId:r,...t}),e.addEventListener("message",a)}}function z(e,t){return e?(N||(e=>{const t=r.p;r.p=window.location.pathname.replace(/[^\/]+\/?$/,""),e(),r.p=t})(()=>{N=new o}),new j(N,t)):new X(t)}const V=new Image(1,1);async function Y(e,t){try{return await createImageBitmap(e,t)}catch{return await createImageBitmap(V,t)}}V.src="data:image/gif;base64,R0lGODlhAQABAIAAAMLCwgAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";const q=async(e,t,r)=>{await u(r);const n=[],a=e.getVideoTracks()[0],o=e.getAudioTracks()[0];let{width:i,height:s}=a.getSettings();const f=z(t.useBackgroundWorker,{setup:t,params:r,videoWidth:i,videoHeight:s});let l;const d=async e=>{const r=await async function(e,t){if(!e)return;let r;return"video"===t?(r=document.createElement("video"),r.loop=!0,await new Promise(t=>{r.addEventListener("playing",t),r.crossOrigin="Anonymous",r.src=e,r.play()}),r.muted=!0):(r=new Image,await new Promise(t=>{r.addEventListener("load",t),r.crossOrigin="Anonymous",r.src=e})),r}(e.backgroundUrl,e.backgroundType);return l=r&&r.play&&(()=>{r.paused&&r.play()}),async function(e,t,r,n){if(!e)return async()=>{};const a=e.videoWidth||e.naturalWidth||e.width,o=e.videoHeight||e.naturalHeight||e.height,i=a/o,s=t/r;if("imagedata"===n){const n=document.createElement("canvas");n.width=t,n.height=r;const u=n.getContext("2d");let[c,f,l,d]=[0,0,t,r];if(i>s){const e=r*i-t;c-=Math.round(e/2),l+=Math.round(e)}else if(i<s){const e=t/i-r;f-=Math.round(e/2),d+=Math.round(e)}return async()=>(u.drawImage(e,0,0,a,o,c,f,l,d),u.getImageData(0,0,t,r).data.buffer)}if("imagebitmap"===n){let[n,u,c,f]=[0,0,a,o];if(i>s){const e=a-o*s;n+=Math.round(e/2),c-=Math.round(e)}else if(i<s){const e=o-a/s;u+=Math.round(e/2),f-=Math.round(e)}return async()=>await createImageBitmap(e,n,u,c,f,{resizeWidth:t,resizeHeight:r})}return"canvas"===n?async()=>e:void 0}(r,i,s,t.transferType)};let m=await d(r),p=null;const g=new Promise(e=>p=e);let h,v;if(t.useInsertableStreams){const e=new window.MediaStreamTrackProcessor({track:a,maxBufferSize:2}),t=new window.MediaStreamTrackGenerator({kind:"video",signalTarget:a});v=t,f.on("ready",()=>{f.start({inputStream:null===e||void 0===e?void 0:e.readable,outputStream:null===t||void 0===t?void 0:t.writable})}),f.on("firstframerendered",()=>p()),f.on("getbackgroundframe",async()=>{l&&(l(),f.updateBackgroundFrame({frame:await m()}))})}else{const e=document.createElement("video"),o=async()=>{const{width:e,height:t}=a.getSettings();i===e&&s===t||(i=e,s=t,"object"===typeof h&&(h.width=i,h.height=s),await f.updateVideoSize({videoWidth:i,videoHeight:s}),await d(r))};e.addEventListener("resize",o),n.push(()=>{e.removeEventListener("resize",o)}),t.keepVideoElementInDom&&(e.playsInline=!0,e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.opacity=0,document.body.appendChild(e),n.push(()=>{try{document.body.removeChild(e)}catch{}e.srcObject=null})),await new Promise(t=>{e.addEventListener("loadedmetadata",t),e.srcObject=new MediaStream([a]),e.play()});const u=()=>{"visible"!==document.visibilityState&&e.play()};let g,b,E;if(document.addEventListener("visibilitychange",u),n.push(()=>{document.removeEventListener("visibilitychange",u)}),h=c(i,s),"imagebitmap"===t.transferType)g=h.getContext("bitmaprenderer"),b=()=>Y(e),E=e=>{g.transferFromImageBitmap(e),e.close()};else if("imagedata"===t.transferType){g=h.getContext("2d");const t=c(i,s).getContext("2d");b=()=>(t.drawImage(e,0,0),t.getImageData(0,0,i,s).data.buffer),E=e=>{e=new ImageData(new Uint8ClampedArray(e),i,s),g.putImageData(e,0,0)}}else"canvas"===t.transferType&&(g=h.getContext(t.useWebGL?"webgl2":"2d",t.useWebGL?t.webglContextSettings:void 0),b=()=>e,t.useWebGL&&t.canvasMemoryLeakWorkaround&&(b=()=>Y(e)),E=()=>{});v=h.captureStream().getVideoTracks()[0];let y=Date.now();const _=async()=>{var e;null===(e=l)||void 0===e||e();const[r,n]=await Promise.all([b(),l&&m()]);f.input({videoFrame:r,backgroundFrame:n,lastRenderTime:y,requestTime:Date.now(),delay:t.framerate?1e3/t.framerate:0})},A=()=>{_()};f.on("ready",()=>{A(),f.start({})}),f.on("output",({frame:e})=>{y=Date.now(),E(e),A(),p&&(p(),p=null)})}f.on("terminated",()=>{n.forEach(e=>e())}),f.init({useInsertableStreams:t.useInsertableStreams,initialBackgroundFrame:await m(),effectCanvas:"canvas"===t.transferType?h:void 0});await g,Object.defineProperty(v,"label",{get:()=>a.label}),Object.defineProperty(v,"readyState",{get:()=>a.readyState}),Object.defineProperty(v,"enabled",{get:()=>a.enabled,set:e=>{a.enabled=e}}),Object.defineProperty(v,"getSettings",{get:()=>()=>a.getSettings()});return{stream:new MediaStream([v,o].filter(e=>e)),stop:()=>{f.terminate()},updateParams:async e=>(await u(e),m=await d(e),f.updateParams({params:e,initialBackgroundFrame:await m()}),!0)}},J=!!document.createElement("canvas").getContext("webgl2"),Z={tfliteSegmentCanvasEffects:{module:n,getDefaultSetup:()=>{const e={useWebGL:J,segmentationModelId:"meetlite",logToConsole:!1,framerate:30,useInsertableStreams:!1,canvasMemoryLeakWorkaround:!0,transferType:"canvas",useBackgroundWorker:!1};return"chrome"===a.a.browserDetails.browser?{...e,useWebGL:!1}:"firefox"===a.a.browserDetails.browser?{...e,transferType:J?"imagebitmap":"canvas"}:"safari"===a.a.browserDetails.browser?{...e,canvasMemoryLeakWorkaround:!1,keepVideoElementInDom:!0}:{...e}},canUse:(e={})=>"safari"===a.a.browserDetails.browser&&J&&e.allowSafari||"chrome"===a.a.browserDetails.browser&&a.a.browserDetails.version>=90||"firefox"===a.a.browserDetails.browser&&a.a.browserDetails.version>=89}},Q=[{id:"slight-blur",pipelineConfigs:{tfliteSegmentCanvasEffects:{params:{backgroundBlur:{amount:"slight"}}}}},{id:"blur",pipelineConfigs:{tfliteSegmentCanvasEffects:{params:{backgroundBlur:{amount:"normal"}}}}},{id:"heavy-blur",pipelineConfigs:{tfliteSegmentCanvasEffects:{params:{backgroundBlur:{amount:"heavy"}}}}}];Q.push(...[{id:"cabin",backgroundUrl:r.e(29).then(r.t.bind(null,480,7))},{id:"concrete",backgroundUrl:r.e(30).then(r.t.bind(null,481,7))},{id:"brick",backgroundUrl:r.e(28).then(r.t.bind(null,482,7))},{id:"sunrise",backgroundUrl:r.e(33).then(r.t.bind(null,483,7))},{id:"day",backgroundUrl:r.e(31).then(r.t.bind(null,484,7))},{id:"night",backgroundUrl:r.e(32).then(r.t.bind(null,485,7))},{id:"custom"}].map(({id:e,backgroundUrl:t})=>({id:"image-"+e,pipelineConfigs:{tfliteSegmentCanvasEffects:{params:{backgroundUrl:t}}}}))),Q.push(...[r.e(27).then(r.bind(null,486)),r.e(26).then(r.bind(null,487))].map((e,t)=>({id:"video-"+(t+1),pipelineConfigs:{tfliteSegmentCanvasEffects:{params:{backgroundType:"video",backgroundUrl:e}}}})));const $=(e,t,r)=>{const n=Q.find(t=>t.id===e);if(!n)return;let a=Object.keys(n.pipelineConfigs).find(e=>Z[e].canUse());if(a||(a=Object.keys(n.pipelineConfigs)[0]),!a)return;const o=n.pipelineConfigs[a],i=Z[a],s={...i.getDefaultSetup(),...o.setup,...t};s.useWebGL=s.useWebGL&&J;return{pipeline:i,mergedSetup:s,mergedParams:{...o.params,...r}}},K=async(e,t,r,n)=>{const{pipeline:o,mergedSetup:i,mergedParams:s}=$(t,r,n);i.logToConsole&&console.log("Setting effect preset "+t,{setup:i,params:s});const{stream:u,stop:c,updateParams:f}=await o.module.createEffectStream(e,i,s),l="safari"===a.a.browserDetails.browser?(()=>{let e=!1;const t=()=>requestAnimationFrame(()=>{e||t()});return t(),()=>e=!0})():()=>{};return{stream:u,stop:()=>{i.logToConsole&&console.log("Stopping effects"),l(),c()},tryUpdate:async(e,t,r)=>{const{pipeline:n,mergedSetup:a,mergedParams:s}=$(e,t,r);return f&&n===o&&JSON.stringify(a)===JSON.stringify(i)?(i.logToConsole&&console.log("Updating to effect preset "+e,{params:s}),await f(s)):(i.logToConsole&&console.log("Cannot update effect, needs to create new pipeline"),!1)}}},ee=(e=((e,t)=>e.canUse(t)),t)=>Q.filter(r=>Object.keys(r.pipelineConfigs).find(n=>e(Z[n],t,r))).map(e=>e.id),te=(e,t)=>{const r={...Z[e].getDefaultSetup(),...t};Z[e].getDefaultSetup=()=>r};"chrome"===a.a.browserDetails.browser&&[{match:/whereby\.com/i,token:"AoVyyWIQO7RgDzpxBLpDjn+qbH7a80qQN2c9UAnMYZXxz9JAK/zGyE7+s5p8SMgfOduvwyhGdaXwww8t/tSrYAsAAABheyJvcmlnaW4iOiJodHRwczovL3doZXJlYnkuY29tOjQ0MyIsImZlYXR1cmUiOiJXZWJDb2RlY3MiLCJleHBpcnkiOjE2Mzg0MDMxOTksImlzU3ViZG9tYWluIjp0cnVlfQ=="},{match:/hereby\.dev/i,token:"Ap8ShATIyimE22CNW155FfFdCGh6x//kSIoVumMBZUp9Yk4DdTquatVe2fHtr/GAM+IQu1qsQ+YMB5fRxywstQIAAABheyJvcmlnaW4iOiJodHRwczovL2hlcmVieS5kZXY6NDQ0MyIsImZlYXR1cmUiOiJXZWJDb2RlY3MiLCJleHBpcnkiOjE2Mzg0MDMxOTksImlzU3ViZG9tYWluIjp0cnVlfQ=="},{match:/appearin\.net/i,token:"AgV5wZ2WSg+I5C6vrhe1y76zjjrJApj38z24JSmF+sb8463iAdfze8MUBU4Yy9yBbtgRN/keaL7rGXL7Oe+VjQsAAABieyJvcmlnaW4iOiJodHRwczovL2FwcGVhcmluLm5ldDo0NDMiLCJmZWF0dXJlIjoiV2ViQ29kZWNzIiwiZXhwaXJ5IjoxNjM4NDAzMTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZX0="}].filter(e=>e.match.test(document.location.hostname)).forEach(e=>{const t=document.createElement("meta");t.httpEquiv="origin-trial",t.content=e.token,document.head.appendChild(t)})}}]);
//# sourceMappingURL=0.c4e35876.chunk.js.map